<!DOCTYPE html>
<html lang="hu">
<head>
<meta charset="UTF-8">
<title>serlegkiraly.hu - Diagnosztika SUPER PRO</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
    body {
        background: #000;
        color: #00ff95;
        font-family: Consolas, monospace;
        padding: 25px;
    }

    h2 { color: #00c8ff; }

    #formBox {
        background: #111;
        padding: 20px;
        width: 350px;
        border: 1px solid #333;
        border-radius: 4px;
    }
    input {
        width: 100%;
        padding: 10px;
        background: #000;
        border: 1px solid #444;
        color: #00ff95;
        margin-bottom: 10px;
    }
    button {
        width: 100%;
        padding: 10px;
        background: #00c8ff;
        border: none;
        color: #000;
        font-weight: bold;
        cursor: pointer;
        margin-top: 10px;
    }
    button:hover { background: #009bc2; }

    .line {
        opacity: 0;
        animation: show 0.35s forwards;
        margin: 4px 0;
    }
    @keyframes show { to { opacity: 1; } }

    .x { color: #ff2e2e; font-weight: bold; }
    .ok { color: #3cff8f; font-weight: bold; }

    .loader {
        border: 4px solid #333;
        border-top: 4px solid #00ff95;
        border-radius: 50%;
        width: 22px;
        height: 22px;
        animation: spin 1s linear infinite;
        display: inline-block;
    }
    @keyframes spin { 100% { transform: rotate(360deg); } }

    #alertBox {
        position: fixed;
        top: 25%;
        left: 50%;
        transform: translateX(-50%);
        background: #1b1b1b;
        color: #ff4040;
        border: 2px solid #ff4040;
        padding: 20px;
        width: 350px;
        text-align: center;
        display: none;
        font-size: 18px;
    }

    #exportBtn {
        margin-top: 25px;
        background: #3cff8f;
        color: #000;
        display: none;
        padding: 12px;
        cursor: pointer;
    }
</style>
</head>
<body>

<h2>serlegkiraly.hu ‚Äì Diagnosztikai Rendszer SUPER PRO</h2>

<div id="alertBox">
    <b>SECURITY ALERT</b><br><br>
    Szokatlan kapcsolat aktivit√°s √©szlelve‚Ä¶<br>
    Elemz√©s folyamatban‚Ä¶
</div>

<div id="formBox">
    <label>FTP Host:</label>
    <input id="host" placeholder="pl. serlegkiraly.hu">
    <button onclick="startScan()">Csatlakoz√°s</button>
</div>

<pre id="console" style="margin-top:30px;"></pre>

<button id="exportBtn" onclick="exportPDF()">üìÑ Kapcsolat Napl√≥ PDF Export</button>

<script>

// ========== PDF EXPORT ==========
function exportPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF();

    const text = document.getElementById("console").innerText;

    doc.setFont("courier", "normal");
    doc.setFontSize(11);
    doc.text(text, 10, 10);

    doc.save("diagnosztikai-naplo.pdf");
}

// ========== START SCAN ==========
function startScan() {
    const host = document.getElementById("host").value.trim();
    if (!host) return alert("√çrd be a hostot!");

    document.getElementById("formBox").style.display = "none";

    setTimeout(() => {
        document.getElementById("alertBox").style.display = "block";
    }, 500);

    setTimeout(() => {
        document.getElementById("alertBox").style.display = "none";
        runDiagnostics(host);
    }, 2400);
}

// ========== MAIN DIAGNOSTICS ==========
async function runDiagnostics(host) {
    const consoleDiv = document.getElementById("console");

    // ===== REAL PING REQUEST =====
    let realPing = await fetch(`https://api.ipapi.is/ping/${host}`).then(r => r.json()).catch(() => null);
    let pingResult = realPing?.response_time_ms ? 
        `Val√≥s ping v√°lasz: ${realPing.response_time_ms} ms` : 
        "PING API hiba vagy t√∫lterhel√©s.";

    // ===== REAL BLACKLIST CHECK =====
    let blacklistStatus = "Blacklista ellen≈ërz√©s sikertelen.";

    try {
        let ipGet = await fetch(`https://api.ipapi.is/?domain=${host}`).then(r => r.json());
        if (ipGet?.ip) {
            let bl = await fetch(`https://api.ipapi.is/blacklist/${ipGet.ip}`).then(r => r.json());
            blacklistStatus = bl.detected 
                ? `‚ùå Feketelist√°n: ${bl.engines.join(", ")}` 
                : "‚úî Nem szerepel feketelist√°n";
        }
    } catch (e) {
        blacklistStatus = "Blacklista lek√©r√©s: Hiba.";
    }

    // ===== FTP LISTA IMIT√ÅCI√ì =====
    const ftpFiles = [
        "-rw-r--r--  1 admin root   2048 Jan 21  2025 index.php",
        "drwxr-xr-x  2 admin root   4096 Jan 17  2025 images",
        "-rw-r--r--  1 admin root   1024 Jan 14  2025 config.json",
        "-rw-r--r--  1 admin root   5320 Jan 12  2025 products.xml",
        "drwxr-xr-x  3 admin root   4096 Jan 10  2025 backup",
        "-rw-r--r--  1 admin root   8870 Jan  9  2025 log.txt"
    ];

    // ===== LOG LINES =====
    const lines = [
        "<span class='loader'></span> Kapcsol√≥d√°s: " + host,
        "TLS k√©zfog√°s‚Ä¶ <span class='ok'>OK</span>",
        "Hiteles√≠t√©s‚Ä¶ <span class='ok'>Sikeres</span>",
        "",
        "‚Üí FTP modul",
        "Lek√©r√©s: leo_ferkovics-teszt.ftp ... <span class='x'>HIBA</span>",
        "Lek√©r√©s: aurionstudio_ftp (84.3.43.176) ... <span class='ok'>‚úî</span>",
        "Lek√©r√©s: k√≥dol√°s_ind√≠t√°sa_4482 ... <span class='x'>HIBA</span>",
        "",
        "‚Üí SSH kapcsolat",
        "Kapcsolat: h@h.com-ferkovics | IP: 178.164.245.50 ... <span class='ok'>‚úî</span>",
        "",
        "‚Üí VAL√ìDI PING LEK√âR√âS",
        pingResult,
        "",
        "‚Üí IP FEKETELISTA ELLEN≈êRZ√âS",
        blacklistStatus,
        "",
        "‚Üí FTP LISTA",
        ...ftpFiles,
        "",
        "‚Üí Legut√≥bbi FTP bel√©p√©sek",
        "84.3.43.176 ... <span class='ok'>‚úî</span>",
        "178.164.245.50 ... <span class='ok'>‚úî</span>",
        "",
        "<span class='ok'>Rendszerellen≈ërz√©s befejezve.</span>"
    ];

    let index = 0;
    function showLine() {
        if (index >= lines.length) {
            document.getElementById("exportBtn").style.display = "block";
            return;
        }
        const div = document.createElement("div");
        div.className = "line";
        div.style.animationDelay = (index * 0.3) + "s";
        div.innerHTML = lines[index];
        consoleDiv.appendChild(div);
        index++;
    }

    for (let i = 0; i < lines.length; i++) {
        setTimeout(showLine, i * 300);
    }
}

</script>
</body>
</html>
